<apex:page standardController="Case" extensions="controladorCasoRetiros" title="Ficohsa FPC" showheader="false" sidebar="false" cache="false" expires="0"
           standardStylesheets="false" showQuickActionVfHeader="false" docType="html-5.0" id="page" applyHtmlTag="false"  applyBodyTag="false" action="{!guardar}">
    
    <html xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" lang="en">
        <head>
            <meta charset="utf-8" /> 
            <meta http-equiv="x-ua-compatible" content="ie=edge" />
            <title>{!Case.CaseNumber}</title>
            <meta name="viewport" content="width=device-width, initial-scale=1" />
            <apex:stylesheet value="{!URLFOR($Resource.SLDS221, 'assets/styles/salesforce-lightning-design-system-vf.min.css')}" />
            <apex:slds /> 
            
            <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
            <script src="/soap/ajax/28.0/connection.js" type="text/javascript"></script> 
            <script>
            sforce.connection.sessionId = '{!$Api.Session_ID}';
            var caseId = '{!Case.Id}'; 
            
            $(document).keydown(function(objEvent) {
                if (objEvent.keyCode == 9) {  //tab pressed
                    objEvent.preventDefault(); // stops its action
                }
            });
            function process() {
                
                UpdateBeneTerMontos();
                
                var result = sforce.connection.query("Select Sum(Monto_retirar__c) suma from Detalle_caso__c Where Caso__c = '"+caseId+"' and Tipo_retiro__c = ''");
                var records = result.getArray("records"); //alert(records[0].suma);             
                if(records[0].suma != null) {
                    var valRetiro = parseFloat(records[0].suma); //alert(valRetiro.toFixed(2));
                    //var montoaRetirar = $("[id$='montoaRetirar']").val(valRetiro.toFixed(2));
                }               
                
                //Inicio pago a beneficiarios / terceros - Tipo de pago
                //$("[id$='tipoPago']").val("0");
                var e = document.querySelectorAll('[id$="tipoPago"]')[0];
                if (e && !e[0].value) {e.remove(0);} 
                //Fin pago a beneficiarios / terceros - Tipo de pago
                
                var result2 = sforce.connection.query("Select Id from Detalle_caso__c Where Caso__c = '"+caseId+"'");
                var records2 = result2.getArray("records"); //alert('resultado: ' +records2[0].Id);             
                if(records2[0].Id != null) {
                    var x = document.getElementById("pagosBT");
                    if (records2[0].Id == null) {
                        x.style.display = "none";
                    } else {
                        x.style.display = "block";
                    }
                }
                            
                var patronalExtraOrdi = $("[id$='patronalExtraOrdi']").val();
                //$("[id$='montopatExt']").val(patronalExtraOrdi);
                
                var montopatExt = $("[id$='montopatExt']").val();
                var porcenpatExt = $("[id$='porcenpatExt']").val(); 
                var nuevoPorc = (montopatExt/patronalExtraOrdi)*100; 
                if(isNaN(nuevoPorc)) { //var value = 0;
                    $("[id$='porcenpatExt']").val(value.toFixed(2));                 
                } else {
                    $("[id$='porcenpatExt']").val(nuevoPorc.toFixed(2)); 
                }
                var montoRetiro = $("[id$='montoRetiro']").val(); 
                //Actualizar monto bruto a retirar
                var montopatOr = $("[id$='montopatOr']").val(); var montopatOr2 = montopatOr.replace(/,/g, ""); 
                var montoTotalidad =  parseFloat(montopatOr2) + parseFloat(montopatExt);  //alert(montoTotalidad);                                         
                //Fin actualizar monto bruto a retirar 
            }
            function recalculatePorcentajePO() {
                var patronalOrdi = $("[id$='patronalOrdi']").val();
                var montopatOr = $("[id$='montopatOr']").val();
                var porcenpatOr = $("[id$='porcenpatOr']").val();
                var nuevoPorcentaje = ((montopatOr/patronalOrdi)*100);
                //alert(nuevoPorcentaje.toFixed(2));
                $("[id$='porcenpatOr']").val(nuevoPorcentaje.toFixed(2));
            }
            function recalculatePorcentajePE() {
                var patronalExtraOrdi = $("[id$='patronalExtraOrdi']").val();
                var montopatExt = $("[id$='montopatExt']").val();
                var porcenpatExt = $("[id$='porcenpatExt']").val();
                var nuevoPorcentaje2 = ((montopatExt/patronalExtraOrdi)*100);
                if(patronalExtraOrdi != 0) {
                    $("[id$='porcenpatExt']").val(nuevoPorcentaje2.toFixed(2));    
                }   
            } 
               
            function UpdateBeneTerMontos() { 
                var montoaRetirar = $("[id$='montoaRetirar']").val();  //alert(montoaRetirar);
                var resultPB = sforce.connection.query("SELECT Id,Caso__c,Detalle_caso__c,Monto_bruto__c,Porcentaje__c,Comisiones_cargos__c,Monto_neto_retirar__c FROM Pago_Beneficiario__c WHERE Caso__c = '"+caseId+"'");
                var recordsPB = resultPB.getArray("records"); //alert(recordsPB);
                if(recordsPB != null) { //alert(recordsPB.length);
                    try {
                        for(var i=0;i<recordsPB.length;i++) {
                            var updatePB = new sforce.SObject("Pago_Beneficiario__c");
                            updatePB.Id = recordsPB[i].Id;
                            updatePB.Monto_bruto__c = parseFloat(montoaRetirar) * (recordsPB[i].Porcentaje__c/100); 
                            updatePB.Monto_neto_retirar__c = recordsPB[i].Monto_bruto__c - recordsPB[i].Comisiones_cargos__c;  
                            resultPB = sforce.connection.update([updatePB]);                        
                            //alert('Datos Actualizados '+resultPB); 
                            //console.log(result);
                        }
                    } catch(err) {
                        alert(err);
                    }    
                }       
            }
            $(document).ready( function () {
                process();
            }); 
            </script>

            <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"/>
            <link rel="stylesheet" href="/resources/demos/style.css"/>
            <!-- script src="https://code.jquery.com/jquery-1.12.4.js"></script -->
            <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
            <script>
              $.datepicker.regional['es'] = {
              closeText: 'Cerrar',
              prevText: '< Ant',
              nextText: 'Sig >',
              currentText: 'Hoy',
              monthNames: ['Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio', 'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'],
              monthNamesShort: ['Ene','Feb','Mar','Abr', 'May','Jun','Jul','Ago','Sep', 'Oct','Nov','Dic'],
              dayNames: ['Domingo', 'Lunes', 'Martes', 'Miércoles', 'Jueves', 'Viernes', 'Sábado'],
              dayNamesShort: ['Dom','Lun','Mar','Mié','Juv','Vie','Sáb'],
              dayNamesMin: ['Do','Lu','Ma','Mi','Ju','Vi','Sá'],
              weekHeader: 'Sm',
              dateFormat: 'mm/dd/yy',
              firstDay: 1,
              isRTL: false,
              showMonthAfterYear: false,
              yearSuffix: ''
             };
             $.datepicker.setDefaults($.datepicker.regional['es']);
             $(function () {
                 $("[id$='datepicker']").datepicker();
             });
            </script>
            
            <script>
                function myFunction() {
                    var flag = $("[id$='formaRetiro']").val(); alert(flag);
                    if(flag == 'CK') { //alert('Entra');
                        callAction(flag);
                    }
                }
            </script>
                        
            <style>
            .scrolling-wrapper {
              overflow-x: scroll;
              overflow-y: hidden;
              white-space: nowrap;
            }
            </style>
            
        </head>
        <body> 
            <script>
            function enterPress(e){  
                if(e.keyCode==13){
                    if(e.prDefault){ 
                        e.prDefault();
                    }
                    else{
                        e.returnValue=false;
                    }
                    searchFunction();
                }        
            }
            function enterPress2(e){
                if(e.keyCode==13){
                    if(e.preventDefault){ 
                        e.preventDefault();
                    }
                    else{
                        e.returnValue=false;
                    }
                    searchFunction2();
                }        
            }
            </script>
            
            <apex:form id="theForm" >
                <apex:actionFunction name="callAction" reRender="yourText" action="{!changeFlag}">
                    <apex:param value="" name="flagValue"/>
                </apex:actionFunction>
                <!-- apex:actionPoller rendered="{!detalleCasoActualizado}" reRender="theForm"  action="{!actualizardetalleCaso}" interval="5" /-->
                <apex:actionFunction action="{!buscarSubPro}" name="searchFunction" />
                <apex:actionFunction action="{!buscarCuentaC}" name="searchFunction2" />
                 <apex:actionStatus id="status">
                <apex:facet name="start">
                    <div style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; opacity: 0.25; z-index: 1000; background-color: black;">
                         
                    </div>
                    
                    <div role="status" class="slds-spinner slds-spinner_large">
                        <span class="slds-assistive-text">Por Favor Espere...</span>
                        <div class="slds-spinner__dot-a"></div>
                        <div class="slds-spinner__dot-b"></div>
                    </div>
                </apex:facet>
            </apex:actionStatus>
                <div class="slds-scope"> 
                    <apex:Messages styleClass="slds-notify slds-notify--alert slds-theme--alert-texture"/>
                    
                    <fieldset class="slds-box slds-align--absolute-center slds-container--medium">
                       
                      <apex:outputpanel rendered="{!cTipoCaso.retiros}"> 
                            <fieldset class="slds-form--compound ">
                                <div class="slds-form-element__group">
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label" >Cuenta</label>
                                            <apex:selectList value="{!idCuenta}" id="idCuentaRetiros" styleclass="slds-select" size="1">
                                                <apex:selectOptions value="{!listCuentas}" />
                                                <apex:actionSupport event="onchange" action="{!selecCuentaRetiros}" reRender="theForm" status="status"  rendered="{!cTipoCaso.retiros}"/>
                                            </apex:selectList>                                       
                                        </div>
                                        <div class="slds-form-element slds-size--2-of-2"> 
                                            <label class="slds-form-element__label" >
                                                <abbr class="slds-required" title="required">*</abbr>Tipo de retiro</label>
                                            <apex:inputField styleClass="slds-select"  value="{!detalleCaso.Tipo_retiro__c}">
                                                <apex:actionSupport event="onchange" action="{!selecTipoRetiro}"/>
                                            </apex:inputField>
                                        </div>
                                    </div>
                                    
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label" >
                                                Comisión por retiro anticipado</label>
                                            <apex:inputField styleclass="slds-input" value="{!detalleCaso.Comision_Retiro_Anticipado__c}"/> 
                                            <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_comision_retiro__c}" />
                                        </div>
                                        <div class="slds-form-element slds-size--2-of-2">
                                            <label class="slds-form-element__label" > Cliente quiere capital semilla</label>
                                            <apex:inputField styleclass="slds-input" value="{!detalleCaso.Cliente_quiere_capital_semilla__c}" >
                                                <apex:actionSupport event="onchange" action="{!selecTipoRetiro}"/>
                                            </apex:inputField> 
                                        </div>
                                    </div>
                                    
                                    <!--apex:outputPanel rendered="{!detallecaso.Cobrar_empleado_sigue_laborando__c}"--> 
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" > Cliente sigue laborando</label>
                                                <apex:inputField styleclass="slds-input" value="{!detalleCaso.Cliente_sigue_Laborando__c}" /> 
                                            </div>
                                            
                                            <div class="slds-form-element slds-size--2-of-2">                                                                                                                     
                                            </div>
                                        </div>
                                    <!--/apex:outputPanel-->
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-1">
                                            <h3 class="slds-section-title--divider">POLITICAS</h3>  
                                        </div>
                                    </div>  
                                    <apex:outputPanel rendered="{!AND(!detalleCaso.Cobro_Individual_CRA__c,!detalleCaso.Cobro_Saldo_Minimo_CRA__c)}">
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">                                       
                                                <label class="slds-form-element__label" >Comisión por retiro anticipado</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Comision_retiro_anticipado_empresa__c}" />                     
                                            </div>
                                            <div class="slds-form-element slds-size--2-of-2">
                                                <label class="slds-form-element__label" >% de Comisión por retiro anticipado</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Porcentaje_comision__c}"/>                                                                                                    
                                            </div>
                                        </div> 
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!OR(detalleCaso.Cobro_Individual_CRA__c, true)}">
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">                                       
                                                <label class="slds-form-element__label" >Cobro Individual CRA</label><br/>
                                                <apex:inputField styleclass="slds-input" value="{!detalleCaso.Cobro_Individual_CRA__c}" />                     
                                            </div>
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" >% CRA individual</label><br/>
                                                <apex:inputField styleclass="slds-input" value="{!detalleCaso.Porcentaje_CRA_Individual__c}"/>                                                                                                    
                                            </div>
                                        </div> 
                                    </apex:outputPanel>
                                   
                                    <apex:outputPanel rendered="{!detalleCaso.Monto_Saldo_Minimo_CRA__c !=null}">
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">                                       
                                                <label class="slds-form-element__label" >Cobro Saldo Minimo CRA</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Cobro_Saldo_Minimo_CRA__c }" />                     
                                            </div>
                                            <div class="slds-form-element slds-size--2-of-2">
                                                <label class="slds-form-element__label" >Monto Saldo minimo CRA</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_Saldo_Minimo_CRA__c}"/>                                                                                                    
                                            </div>
                                        </div> 
                                    </apex:outputPanel>
                                    
                                    <!--apex:outputPanel rendered="{!If(cuentaCliente.Cuenta_colectiva2__c != null,true,false)}"-->
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">   
                                                <label class="slds-form-element__label" >Cobro si empleado sigue laborando</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Cobrar_empleado_sigue_laborando__c}"/>
                                            </div>
                                            <div class="slds-form-element slds-size--2-of-2">
                                                <apex:outputPanel rendered="{!If(cuentaCliente.Cuenta_colectiva2__c != null,true,false)}">
                                                    <label class="slds-form-element__label">
                                                        Permitir Retiro de Saldos Patronales</label><br/>
                                                    <apex:outputField styleclass="slds-input" value="{!detalleCaso.Permitir_Retiro_Saldos_Patronales__c}" /> 
                                                </apex:outputPanel> 
                                            </div>
                                        </div>     
                                    <!--/apex:outputPanel-->  
                                    
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label" >Exoneracion 3ra Edad</label>
                                            <apex:outputField styleclass="slds-input" value="{!detalleCaso.Exoneracion_3ra_Edad__c}" /> 
                                            <!--:outputText  value="{!anosCliente} Años" /--> 
                                        </div>
                                        
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label" >Edad</label><br/>
                                            <apex:outputText value="{!anosCliente} Años" /> 
                                        </div>
                                    </div>
                                    
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-1">
                                            <h3 class="slds-section-title--divider">FORMA DE RETIRO</h3>    
                                        </div>
                                    </div>
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label" >
                                                <abbr class="slds-required" title="required">*</abbr>Forma de retiro</label>
                                            <apex:inputField styleclass="slds-input" value="{!detalleCaso.Forma_Retiro__c}">
                                                <apex:actionSupport event="onchange" action="{!accionVacia2}"/>
                                            </apex:inputField>   
                                        </div>
                                        <div class="slds-form-element slds-size--2-of-2">
                                            <div>
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" title="required">*</abbr>Cobro de TSP</label><br/>
                                                <div>
                                                    <apex:inputField styleclass="slds-input" value="{!detalleCaso.Cobro_TSP__c}" />
                                                    <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_TSP__c}" />    
                                                </div>
                                            </div>
                                            <apex:outputPanel rendered="{!If(detalleCaso.Forma_Retiro__c = 'CK',true,false)}">
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" title="required">*</abbr>Cobro de Cheque</label><br/>
                                                <div>
                                                    <apex:inputField styleclass="slds-input" value="{!detalleCaso.Cobro_Cheque__c}" />
                                                    <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_cheque__c}" /> 
                                                </div>                                              
                                            </apex:outputPanel>                                       
                                        </div>
                                    </div>
                                    
                                    <apex:outputPanel rendered="{!OR(detalleCaso.Forma_Retiro__c = 'AH',detalleCaso.Forma_Retiro__c = 'ACH')}">
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" >
                                                    <abbr class="slds-required" title="required">*</abbr>Cuenta Origen</label>
                                                <apex:inputField styleclass="slds-input" value="{!detalleCaso.Cuenta_destino__c}" />
                                            </div> 
                                            <div class="slds-form-element slds-size--2-of-2">
                                                
                                            </div>                                  
                                        </div>
                                        
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--2-of-2">
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" title="required">*</abbr>Tipo de cuenta</label><br/>
                                                <apex:inputField styleclass="slds-input" value="{!detalleCaso.Tipo_Cuenta__c}"/> 
                                            </div>
                                            <div class="slds-form-element slds-size--2-of-2">
                                                <label class="slds-form-element__label" >
                                                    <abbr class="slds-required" title="required">*</abbr>Moneda de la cuenta</label>
                                                <apex:inputText styleclass="slds-input" value="{!detalleCaso.currencyIsoCode}" /> 
                                            </div>
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" >
                                                    <abbr class="slds-required" title="required">*</abbr># Cuenta Destino</label>
                                                <apex:inputText styleclass="slds-input" value="{!detalleCaso.N_Cuenta_Bancaria__c}" />
                                            </div>
                                            <div class="slds-form-element slds-size--2-of-2" >
                                                <label class="slds-form-element__label" />
                                                <div>
                                                    <apex:commandButton rendered="{!detalleCaso.Forma_Retiro__c == 'AH'}" value="Verificar" action="{!verPropietarioCuenta}" 
                                                                        styleClass="slds-button slds-button--success"/>  
                                                </div> 
                                            </div>
                                        </div>
                                        
                                        <apex:outputPanel rendered="{!detalleCaso.Forma_Retiro__c == 'AH'}">
                                            <div class="slds-form-element__row">
                                                <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_info" role="alert">
                                                    <span class="slds-assistive-text">info</span>
                                                    <span class="slds-icon_container slds-icon-utility-user slds-m-right_x-small" title="Description of icon when needed">
                                                        <svg class="slds-icon slds-icon_x-small" aria-hidden="true">
                                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#user"></use>
                                                        </svg>
                                                    </span>
                                                    <apex:outputField styleclass="slds-input" value="{!detalleCaso.Propietario_cuenta__c}" />
                                                </div>
                                            </div>
                                        </apex:outputPanel>
                                    </apex:outputPanel>
                                    
                                    <apex:outputPanel rendered="{!detalleCaso.Forma_Retiro__c = 'ACH'}">    
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" >
                                                    <abbr class="slds-required" title="required">*</abbr>Banco</label>
                                                <apex:inputField styleclass="slds-input" value="{!detalleCaso.Banco__c}"/> 
                                            </div>
                                            <div class="slds-form-element slds-size--2-of-2">                                       
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" title="required">*</abbr>Cobro de ACH</label><br/>
                                                <div>
                                                    <apex:inputField styleclass="slds-input" value="{!detalleCaso.Cobro_ACH__c}" /> 
                                                    <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_ACH__c}" />    
                                                </div>                                                               
                                            </div>
                                        </div>                              
                                    </apex:outputPanel>
                                    <apex:outputPanel rendered="{!detalleCaso.Permitir_Retiro_Saldos_Patronales__c}">
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-1">
                                                <h3 class="slds-section-title--divider">POLITICAS APORTES PATRONALES</h3>  
                                            </div>
                                        </div>  
                                        
                                        <apex:outputPanel rendered="{!detalleCaso.Tipo_Politica_Retiro_Saldo_Patronal__c='1'}" >
                                            <div class="slds-form-element__row">
                                                <div class="slds-form-element slds-size--1-of-2">
                                                    <label class="slds-form-element__label" >
                                                        <abbr class="slds-required"></abbr>Fecha de Ingreso a la Empresa</label><br/>
                                                    <apex:outputField rendered="{!case.status !='Nuevo'}"  styleclass="slds-input" value="{!detalleCaso.Fecha_Ingreso_Empresa__c}"/> 
                                                    <apex:inputField type="date" rendered="{!case.status ='Nuevo'}" styleclass="slds-input" value="{!detalleCaso.Fecha_Ingreso_Empresa__c}">
                                                        <apex:actionSupport action="{!calculoSaldoPatronales}" rendered="{!detalleCaso.Fecha_Despido_Empresa__c != null}" reRender="theForm" status="status" event="onchange" />
                                                    </apex:inputField>                                                    
                                                </div>
                                                <div class="slds-form-element slds-size--1-of-2">                                       
                                                    <label class="slds-form-element__label">
                                                        <abbr class="slds-required" ></abbr>Fecha de Despido de la Empresa</label><br/>
                                                    <apex:inputField type="date"  rendered="{!case.status ='Nuevo'}" styleclass="slds-input"  value="{!detalleCaso.Fecha_Despido_Empresa__c}" >
                                                        <apex:actionSupport action="{!calculoSaldoPatronales}" oncomplete="bloquearCampos();" reRender="theForm" status="status" event="onchange" />
                                                    </apex:inputField>
                                                    <apex:outputField rendered="{!case.status !='Nuevo'}" styleclass="slds-input"  value="{!detalleCaso.Fecha_Despido_Empresa__c}" />
                                                    
                                                </div>
                                            </div> 
                                        </apex:outputPanel>
                                        
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" > Monto Sldo Patronal Ordinario</label><br/>
                                                <!-- apex:inputField styleclass="slds-input" id="montopatOr" value="{!detalleCaso.Monto_Saldo_Patronal__c}" onchange="recalculatePorcentajePO();"/ -->
                                                <apex:inputField styleclass="slds-input" id="montopatOr" value="{!detalleCaso.Monto_Saldo_Patronal__c}">
                                                    <apex:actionSupport action="{!calculoSaldoPatronales2}" reRender="theForm" status="status" event="onchange" onsubmit="recalculatePorcentajePO();" />
                                                </apex:inputField> 
                                            </div>
                                            <div class="slds-form-element slds-size--1-of-2">                                       
                                                <label class="slds-form-element__label">% Saldo Patronal Ordinario</label><br/>
                                                <!-- apex:inputField styleclass="slds-input" id="porcenpatOr" value="{!detalleCaso.Porcentaje_Saldo_Patronal__c}" onchange="recalculateAmountPO();"/ -->
                                                <apex:inputField styleclass="slds-input" id="porcenpatOr" value="{!detalleCaso.Porcentaje_Saldo_Patronal__c}">
                                                    <apex:actionSupport action="{!calculoSaldoPatronales2}" reRender="theForm" status="status" event="onchange" />
                                                </apex:inputField>   
                                                <!-- apex:inputText styleClass="slds-input" value="{!detalleCaso02.Monto_saldo__c}" id="patronalOrdi"/ --> 
                                                <apex:inputText styleClass="slds-hidden" value="{!montoPatOrd}" id="patronalOrdi"/>  
                                                <!-- apex:inputText styleClass="slds-input" value="{!montoBrutoRetiro}" id="montoBrutoRetiro"/ -->
                                                <apex:inputText styleClass="slds-hidden" value="{!montoaRetirar}" id="montoaRetirar"/>                                                          
                                            </div>
                                        </div>
                                        
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" > Monto Sldo Patronal Extraordinario</label><br/>
                                                <!-- apex:inputField styleclass="slds-input" id="montopatExt" value="{!detalleCaso.Monto_Saldo_Patronal_Ext__c}" onchange="recalculatePorcentajePE();"/ -->
                                                <apex:inputField styleclass="slds-input" id="montopatExt" value="{!detalleCaso.Monto_Saldo_Patronal_Ext__c}">
                                                    <apex:actionSupport action="{!calculoSaldoPatronales2}" reRender="theForm" status="status" event="onchange" onsubmit="recalculatePorcentajePE();" />
                                                </apex:inputField> 
                                                <!-- apex:inputText styleClass="slds-input" value="{!detalleCaso03.Monto_saldo__c}" id="patronalExtraOrdi"/ -->
                                                <apex:inputText styleClass="slds-hidden" value="{!montoPatExtOrd}" id="patronalExtraOrdi"/>
                                                <!-- apex:inputText styleClass="slds-input" value="{!detalleCaso04.Monto_Bruto_Retirar_Empresa__c}" id="montoRetiro"/ -->
                                            </div>
                                            <div class="slds-form-element slds-size--1-of-2">                                       
                                                <label class="slds-form-element__label">% Saldo Patronal Extraordinario</label><br/>
                                                <!-- apex:inputField styleclass="slds-input" id="porcenpatExt" value="{!detalleCaso.Porcentaje_Saldo_Patronal_Ext__c}" onchange="recalculateAmountPE();"/ -->
                                                <apex:inputField styleclass="slds-input" id="porcenpatExt" value="{!detalleCaso.Porcentaje_Saldo_Patronal_Ext__c}">
                                                    <apex:actionSupport action="{!calculoSaldoPatronales2}" reRender="theForm" status="status" event="onchange" />
                                                </apex:inputField>                                                                                                             
                                            </div>
                                        </div>

                                    </apex:outputPanel>

                                    <!--apex:outputPanel rendered="{!detalleCaso.saldo_prestamo__C != null}"-->
                                     <apex:outputPanel rendered="{!if(detalleCaso.Monto_Pignorado__c != 0,if(detalleCaso.Monto_Pignorado__c != null,true,false),false)}">
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-1">
                                                <h3 class="slds-section-title--divider">PRESTAMO                                        
                                                </h3>   
                                            </div>
                                        </div>    
                                        
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" >
                                                    <abbr class="slds-required" title="required"></abbr>Monto Pignorado</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_Pignorado__c}"/> 
                                            </div>
                                            <div class="slds-form-element slds-size--2-of-2">                                       
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" ></abbr>Saldo del Prestamo</label><br/>
                                                <div>
                                                    <apex:inputField rendered="{!or(case.status='Nuevo',case.status='Pendiente de aprobación')}" styleclass="slds-input"  value="{!detalleCaso.Saldo_Prestamo__c}" >
                                                        <apex:actionSupport action="{!ModificarSaldoPrestamo}" event="onchange" reRender="theForm" status="status" />
                                                    </apex:inputField>
                                                    <apex:outputField rendered="{!IF(case.status !='Nuevo',if(case.status !='Pendiente de aprobación',true,false),false)}" styleclass="slds-input"  value="{!detalleCaso.Saldo_Prestamo__c}" />
                                                </div>                                                               
                                            </div>
                                        </div>                              
                                    </apex:outputPanel>
                                    <apex:outputPanel id="idsubProductos" rendered="{!AND(case.status !='Pendiente de aprobación',case.status !='Pendiente segunda aprobación')}">
                                    <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-1">
                                                
                                                <h3 class="slds-section-title--divider"><!--apex:outputPanel> <apex:inputField styleclass="slds-input" value="{!detalleCaso.Aplica_Cambio_Sub_Producto_desde_Retiros__c}" >  
                                                        <apex:actionSupport action="{!accionVacia2}" event="onchange"  />
                                                    </apex:inputField></apex:outputPanel-->CAMBIO DE SUB-PRODUCTO       
                                                    <apex:inputField style="width:100px;height:30px;" value="{!detalleCaso.Aplica_Cambio_Sub_Producto_desde_Retiros__c}" >  
                                                        <apex:actionSupport action="{!accionVacia2}" event="onchange"  />
                                                    </apex:inputField>
                                                    
                                                </h3>   
                                            </div>
                                        </div>  
                                    
                                    <!--apex:outputpanel-->
                                    <apex:outputpanel rendered="{!detalleCaso.Aplica_Cambio_Sub_Producto_desde_Retiros__c}"> 
                                        <fieldset class="slds-form--compound ">
                                            <div class="slds-form-element__group">
                                                
                                                <div class="slds-form-element__row">
                                                    <div class="slds-form-element slds-size--1-of-2">
                                                        <label class="slds-form-element__label" >
                                                           Motivo del Caso</label><br/>
                                                        Retención
                                                    </div>
                                                    <div class="slds-form-element slds-size--2-of-2">
                                                        <!--label class="slds-form-element__label">Producto</label><br/ >
                                                        <apex:outputField styleclass="slds-input" value="{!cuentaCliente.Producto__r.Name}" /--> 
                                                    </div>
                                                </div>
                                                
                                                <div class="slds-form-element__row">
                                                    <div class="slds-form-element slds-size--1-of-2">
                                                        <label class="slds-form-element__label" >
                                                            <abbr class="slds-required" title="required">*</abbr>Acción</label><br/>
                                                        <apex:inputField styleclass="slds-input" value="{!detalleCaso.Accion__c}"><!-- required="true"-->
                                                            <apex:actionSupport event="onchange" action="{!accionSubproducto}"/>
                                                        </apex:inputField> 
                                                    </div>
                                                    <div class="slds-form-element slds-size--2-of-2">
                                                        <label class="slds-form-element__label">Producto</label><br/ >
                                                        <apex:outputField rendered="{!detalleCaso.Producto_Anterior__c =null}" styleclass="slds-input" value="{!cuentaCliente.Producto__r.Name}" /> 
                                                        <apex:outputField rendered="{!detalleCaso.Producto_Anterior__c !=null}" styleclass="slds-input" value="{!detalleCaso.Producto_Anterior__c}" /> 
                                                    </div>
                                                </div>
                                                
                                                <div class="slds-form-element__row">
                                                    <div class="slds-form-element slds-size--1-of-2">
                                                        <label class="slds-form-element__label" >Cuenta Colectiva</label><br/>
                                                        <apex:outputField rendered="{!OR(Caso.status !='Cerrado', detalleCaso.Detalle_Cuenta_colectiva__c =null)}" styleclass="slds-input" value="{!cuentaCliente.Detalle_Cuenta_colectiva__c}" /> 
                                                        <apex:outputField rendered="{!AND(Caso.status ='Cerrado', detalleCaso.Detalle_Cuenta_colectiva__c !=null)}" styleclass="slds-input" value="{!detalleCaso.Detalle_Cuenta_colectiva__c}" /> 
                                                    </div>
                                                    <div class="slds-form-element slds-size--2-of-2">
                                                        <apex:outputPanel rendered="{!if(detalleCaso.Accion__c = 'A1',true,false)}">
                                                            <label class="slds-form-element__label">Nueva Cuenta colectiva</label><br/>
                                                            <div class="slds-input-has-icon slds-input-has-icon--right">                                   
                                                                <apex:commandLink action="{!buscarCuentaC}">
                                                                    <svg class="slds-input__icon" aria-hidden="true">                                            
                                                                        <use xlink:href="{!URLFOR($Resource.SLDS221, '/assets/icons/utility-sprite/svg/symbols.svg#search')}"></use>                                           
                                                                    </svg>
                                                                </apex:commandLink>
                                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Detalle_Cuenta_colectiva__c}" />
                                                            </div>  
                                                        </apex:outputPanel>
                                                    </div>
                                                </div>
                                                
                                                <div class="slds-form-element__row">
                                                    <div class="slds-form-element slds-size--1-of-2">
                                                        <label class="slds-form-element__label" >Subproducto</label><br/>
                                                        <!--apex:outputField styleclass="slds-input" value="{!cuentaCliente.Detalle_Subproducto__c}" /--> 
                                                        <apex:outputField rendered="{!OR(Caso.status !='Cerrado', detalleCaso.Detalle_subproducto2__c =null)}" styleclass="slds-input" value="{!cuentaCliente.Detalle_Subproducto__c}" /> 
                                                        <apex:outputField rendered="{!AND(Caso.status ='Cerrado', detalleCaso.Detalle_subproducto2__c !=null)}" styleclass="slds-input" value="{!detalleCaso.Detalle_subproducto2__c}" />
                                                    </div>
                                                    <div class="slds-form-element slds-size--2-of-2">
                                                        <label class="slds-form-element__label">Nuevo Subproducto</label><br/>
                                                        <div class="slds-input-has-icon slds-input-has-icon--right">                                   
                                                            <apex:commandLink action="{!buscarSubPro}" rendered="{!detalleCaso.Accion__c != 'A1'}" >
                                                                <svg class="slds-input__icon" aria-hidden="true">                                            
                                                                    <use xlink:href="{!URLFOR($Resource.SLDS221, '/assets/icons/utility-sprite/svg/symbols.svg#search')}"></use>                                           
                                                                </svg>
                                                            </apex:commandLink>
                                                            <apex:outputField styleclass="slds-input" value="{!detalleCaso.Detalle_subproducto__c}" />
                                                        </div>  
                                                    </div>
                                                </div>
                                                
                                            </div>
                                        </fieldset>                                                       
                                    </apex:outputpanel>
                                    </apex:outputPanel>
                                    
                                        
                                        <!-- <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label" >
                                                    <abbr class="slds-required" title="required"></abbr>Monto Pignorado</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_Pignorado__c}"/> 
                                            </div>
                                            <div class="slds-form-element slds-size--2-of-2">                                       
                                                <label class="slds-form-element__label">
                                                    <abbr class="slds-required" ></abbr>Saldo del Prestamo</label><br/>
                                                <div>
                                                    <apex:inputField rendered="{!or(case.status='Nuevo',case.status='Pendiente de aprobación')}" styleclass="slds-input"  value="{!detalleCaso.Saldo_Prestamo__c}" >
                                                        <apex:actionSupport action="{!ModificarSaldoPrestamo}" event="onchange" reRender="theForm" status="status" />
                                                    </apex:inputField>
                                                    <apex:outputField rendered="{!IF(case.status !='Nuevo',if(case.status !='Pendiente de aprobación',true,false),false)}" styleclass="slds-input"  value="{!detalleCaso.Saldo_Prestamo__c}" />
                                                </div>                                                               
                                            </div>
                                        </div> -->          
                                    
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-1">
                                            <h3 class="slds-section-title--divider">SALDOS A RETIRAR                                        
                                            </h3>   
                                        </div>
                                    </div>                                              
                                    <apex:DataTable value="{!cuentasCaso}" id="idtableSaldos" var="item" styleClass="slds-table slds-table--bordered">
                                        <apex:column headerValue="Saldo">
                                            <apex:OutputField value="{!item.Saldo_retirar__c}"/>                                                                                                           
                                        </apex:column>  
                                        <apex:column headerValue="Monto del Saldo">
                                            <apex:OutputField value="{!item.Monto_saldo__c}"/>                                                                                                         
                                        </apex:column>  
                                        <apex:column headerValue="Monto a retirar" rendered="{!detalleCaso.Tipo_retiro__c == '51'}">
                                            <!-- apex:inputField value="{!item.Monto_retirar__c}" 
                                                             rendered="{!OR(AND(item.Saldo_retirar__c = '12', detalleCaso.Permitir_Retiro_Saldos_Patronales__c),
                                                                       AND(item.Saldo_retirar__c != '12', item.Saldo_retirar__c != '13'))}" >
                                                <apex:actionSupport rendered="{!OR(AND(item.Saldo_retirar__c = '12', detalleCaso.Permitir_Retiro_Saldos_Patronales__c))}"
                                                                    action="{!ValidacionSaldoPatronales}" event="onchange" reRender="theForm" status="status" >
                                                    <apex:param assignTo="{!tipoSaldo}" value="{!item.Saldo_retirar__c}" name="Validaciones" />
                                                </apex:actionSupport>
                                            </apex:inputField -->
                                            <apex:inputField value="{!item.Monto_retirar__c}">
                                                <apex:actionSupport rendered="{!OR(AND(item.Saldo_retirar__c = '12', detalleCaso.Permitir_Retiro_Saldos_Patronales__c),item.Saldo_retirar__c = '13')}"
                                                                    action="{!ValidacionSaldoPatronales}" event="onchange" reRender="idtableSaldos" status="status" >
                                                    <apex:param assignTo="{!tipoSaldo}" value="{!item.Saldo_retirar__c}" name="Validaciones" />
                                                </apex:actionSupport>
                                            </apex:inputField>
                                            
                                            <!-- apex:outputField value="{!item.Monto_retirar__c}" 
                                                              rendered="{!OR(AND(item.Saldo_retirar__c = '12', !detalleCaso.Permitir_Retiro_Saldos_Patronales__c),item.Saldo_retirar__c == '13')}" / -->                                                                                                            
                                        </apex:column>                                                                              
                                    </apex:DataTable> 
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label" >Saldo total de la cuenta</label><br/>
                                            <apex:OutputField value="{!detalleCaso.Saldo_total__c}"/>
                                        </div>
                                        <div class="slds-form-element slds-size--2-of-2">                                       
                                            <label class="slds-form-element__label">Monto bruto a retirar</label><br/>
                                            <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_bruto_retirar__c}" />                                                                   
                                        </div>
                                    </div>  
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label" >Comisiones y cargos </label><br/>
                                            <apex:OutputField value="{!detalleCaso.Monto_total_comisiones_recargos__c}"/>
                                        </div>
                                        <div class="slds-form-element slds-size--2-of-2">                                       
                                            <label class="slds-form-element__label" >Monto neto a retirar</label><br/>
                                            <apex:OutputField value="{!detalleCaso.Monto_total_retirar__c}"/>                                                                
                                        </div>
                                    </div>
                                    <div class="slds-form-element__row">
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label">Exonerado en este caso</label><br/>
                                            <apex:outputField styleclass="slds-input" value="{!detalleCaso.Exonerado__c}" />
                                        </div> 
                                        <div class="slds-form-element slds-size--1-of-2">
                                            <label class="slds-form-element__label">Monto exonerado al día de hoy</label><br/>
                                            <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_info" role="alert">
                                                <span class="slds-assistive-text">info</span>
                                                <span class="slds-icon_container slds-icon-utility-user slds-m-right_x-small" />
                                                <!-- apex:outputField styleclass="slds-input" value="{!detalleCaso.Total_exonerado__c}" / -->
                                                <apex:outputText value="HNL{0, number, ###,###,##0.##}">
                                                    <apex:param value="{!detalleCaso.Total_exonerado__c}" />
                                                </apex:outputText>
                                                
                                            </div>
                                        </div>                                                              
                                    </div>
                                    
                                    <apex:outputPanel rendered="{!detalleCaso.Se_lleva_Parte_Patronal__c}">
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-1">
                                                <h3 class="slds-section-title--divider">RETIRO PARTE PATRONAL                                        
                                                </h3>   
                                            </div>
                                        </div>  
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label">Monto Bruto a retirar</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_Bruto_Retirar_Empresa__c}" />
                                            </div> 
                                            <div class="slds-form-element slds-size--2-of-2">
                                                <label class="slds-form-element__label">Monto neto a retirar</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Monto_Neto_Retirar_Empresa__c}" />
                                            </div>                                                              
                                        </div>
                                        
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-2">
                                                <label class="slds-form-element__label">Comisiones y cargos</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!detalleCaso.Total_Cargos_Empresa__c}" />
                                            </div> 
                                            <div class="slds-form-element slds-size--2-of-2">
                                                 <label class="slds-form-element__label">Forma de Pago</label><br/>
                                                <apex:outputField styleclass="slds-input" value="{!cuentaCliente.Cuenta_colectiva2__r.Tipo_Cuenta__c}" />
                                            </div>                                                              
                                        </div>
                                        
                                    </apex:outputPanel>
                                    
                                    <div id="pagosBT" style="{!pagosBT}">
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-1">
                                                <h3 class="slds-section-title--divider">PAGO A BENEFICIARIOS / TERCEROS</h3>  
                                                <!-- apex:inputText styleClass="slds-INPUT" value="{!montoaRetirar}" id="montoaRetirar2"/ -->
                                            </div>
                                        </div> 
                                        <div class="slds-form-element__row">
                                            <div class="slds-form-element slds-size--1-of-1">
                                                <abbr class="slds-required">*</abbr><label class="slds-form-element__label">Elija la opción</label><br/>
                                                <!-- apex:inputField style="width: 5% !important;" styleclass="slds-input" value="{!detalleCaso.Pago_terceros__c}" / -->
                                                <!-- <apex:inputField styleclass="slds-input" style="width: 5% !important;" value="{!detalleCaso.Pago_terceros__c}" >
                                                    <apex:actionSupport event="onchange" action="{!verBeneficiarios2}"/>
                                                </apex:inputField> -->                                            
                                                <apex:inputField id="tipoPago" style="width: 100% !important;" styleclass="slds-input" value="{!detalleCaso.Tipo_pago__c}">
                                                    <apex:actionSupport event="onchange" action="{!verBeneficiarios2}"/>
                                                </apex:inputField>
                                            </div>                                            
                                        </div>
                                        <div class="slds-form-element__row">
                                            <apex:commandButton action="{!verBeneficiarios2}" styleClass="slds-button slds-button_brand" value="Ver Registros" id="theButton"/>
                                            <!-- apex:commandButton action="{!verBeneficiarios2}" styleClass="slds-button slds-button_brand" value="Ver Registros">
                                                <apex:param name="MS_Item" value="{!detalleCaso.Tipo_pago__c}" assignTo="{!detalleCaso.Tipo_pago__c}" />
                                            </apex:commandButton -->
                                        </div>
                                    </div>                                  
                                                                    
                                </div>
                            </fieldset>                 
                        </apex:outputpanel> 
                    </fieldset>
                    <fieldset class="slds-form--compound ">
                        <div class="slds-form-element__group">
                            <div class="slds-form-element__row">
                                <div class="slds-form-element slds-size--1-of-2">   </div>
                                <div class="slds-form-element slds-size--2-of-2">
                                    <br/>
                                    <apex:commandButton value="Guardar" action="{!guardar}" styleClass="slds-button slds-button--brand"
                                                        rendered="{!AND(mostrarGuardar, !cTipoCaso.reversiones)}"/>
                                                        
                                </div>
                            </div>
                        </div>
                    </fieldset>
                    <apex:outputPanel rendered="{!popCuentaC}">
                        <div role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open slds-modal_large">
                            <div class="slds-modal__container">
                                <div class="slds-modal__header">
                                    <table>
                                        <tr>
                                            <td>CUENTAS COLECTIVAS</td>
                                            <td><apex:inputtext styleclass="slds-input"  value="{!nombreCuenta}" onkeypress="enterPress2(event)"/></td>
                                            <td><div class="slds-button-group" role="group">
                                                <apex:commandLink value="Buscar" id="botonBuscar" styleclass="slds-button slds-button--brand" action="{!buscarCuentaC}"/> 
                                                <apex:commandLink value="Cerrar" styleclass="slds-button slds-button--neutral" action="{!cerrar}"/> 
                                                </div></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="slds-modal__content">
                                    <apex:DataTable value="{!cuentasColectivas}" var="item" styleClass="slds-table slds-table--bordered">
                                        <apex:column headerValue="Número">
                                            <apex:commandLink action="{!cerrar}"> 
                                                <apex:OutputField value="{!item.Name}"/> 
                                                <apex:param name="pV1" value="{!item.id}" assignTo="{!detalleCaso.Nueva_Cuenta_colectiva2__c}"/>
                                                <apex:param name="pDetC" value="{!item.Name}" assignTo="{!detalleCaso.Detalle_Cuenta_colectiva__c}"/>    
                                                <apex:param name="Algo" value="{!item.Subproducto__c}" assignTo="{!detalleCaso.Nuevo_Subproducto__c}"/>
                                                <apex:param name="pCCSB2" value="{!item.Subproducto__r.Name}" assignTo="{!detalleCaso.Detalle_subproducto__c}"/>                                        
                                            </apex:commandLink>                                 
                                        </apex:column>  
                                        <apex:column Value="{!item.Subproducto__r.Name}" />                                                                               
                                    </apex:DataTable> 
                                </div>
                            </div>
                        </div>
                        <div class="slds-backdrop slds-backdrop--open"></div>
                    </apex:outputPanel>
                    
                    
                    
                    <apex:outputPanel rendered="{!popBene}">
                    <div style="overflow: auto; width: 100%; height: 200px;">
                        <div role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open slds-modal_large">
                            <div class="slds-modal__container">
                                <div class="slds-modal__header">
                                    <apex:commandLink action="{!cerrar}" styleclass="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close">
                                        <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Resource.SLDS221, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                        </svg>
                                        <span class="slds-assistive-text">Cerrar</span>
                                    </apex:commandLink>  
                                    
                                    <apex:commandButton value="Agregar Beneficiarios" action="{!agregarBeneficiarios}" styleClass="slds-button slds-button--brand" />
                                    
                                </div>
                                <div class="slds-modal__content slds-p-around--medium">
                                    <apex:pageBlock >
                                        <apex:pageBlockTable value="{!listBeneficiarios}" var="item" >
                                            <apex:column headerValue="Seleccionar">
                                                <apex:inputField value="{!item.Casilla__c}"/>                           
                                            </apex:column> 
                                            <apex:column Value="{!item.Primer_Nombre__c}" />                
                                            <apex:column Value="{!item.Segundo_Nombre__c}" />  
                                            <apex:column Value="{!item.Primer_Apellido__c}" />  
                                            <apex:column Value="{!item.Segundo_Apellido__c}" /> 
                                            <apex:column Value="{!item.Identidad__c}" /> 
                                            <apex:column Value="{!item.Parentesco__c}" /> 
                                            <apex:column Value="{!item.Porcentaje__c}" /> 
                                            <apex:column Value="{!item.Fecha_Nacimiento__c}" /> 
                                            <apex:column Value="{!item.Sexo__c}" /> 
                                            
                                        </apex:pageBlockTable> 
                                    </apex:pageBlock>
                                </div>
                            </div>
                        </div>
                        <div class="slds-backdrop slds-backdrop--open"></div>
                    </div>
                    </apex:outputPanel>
                                        
                    <!-- Beneficiarios caso retiro 03/03/2020 -->
                    <apex:outputPanel rendered="{!popBene2}">
                        <div role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open slds-modal_large">
                            <div class="slds-modal__container">
                                <div class="slds-modal__header">
                                    <apex:commandLink action="{!cerrar}" styleclass="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close">
                                        <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Resource.SLDS221, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                        </svg>
                                        <span class="slds-assistive-text">Cerrar</span>
                                    </apex:commandLink>  
                                    
                                    <div style="{!CASE($Profile.Name,"Operaciones",'display:none;',"Operaciones y Tecnologia",'display:none;','')}">
                                        <apex:commandButton value="Agregar" action="{!addPagoBene}" styleClass="slds-button slds-button--brand" />
                                        <apex:commandButton value="Siguiente" action="{!upsertBeneficiarios}" styleClass="slds-button slds-button--brand" />
                                    </div>    
                                    
                                </div>
                                <div class="slds-modal__content slds-p-around--medium">
                                    <!-- <apex:pageBlock >
                                        <apex:pageBlockTable value="{!listBeneficiarios}" var="item" >
                                            <apex:column headerValue="Seleccionar">
                                                <apex:inputField value="{!item.Casilla__c}"/>                           
                                            </apex:column> 
                                            <apex:column Value="{!item.Primer_Nombre__c}" />                
                                            <apex:column Value="{!item.Segundo_Nombre__c}" />  
                                            <apex:column Value="{!item.Primer_Apellido__c}" />  
                                            <apex:column Value="{!item.Segundo_Apellido__c}" /> 
                                            <apex:column Value="{!item.Identidad__c}" /> 
                                            <apex:column Value="{!item.Parentesco__c}" /> 
                                            <apex:column Value="{!item.Porcentaje__c}" /> 
                                            <apex:column Value="{!item.Fecha_Nacimiento__c}" /> 
                                            <apex:column Value="{!item.Sexo__c}" /> 
                                            <apex:column Value="{!item.Pago_a_Tercero__c}" />
                                        </apex:pageBlockTable> 
                                    </apex:pageBlock> -->
                                    
                                    <apex:pageBlock id="popBeneficiarios"> 
                                        <apex:variable var="rowNum" value="{!0}"  />         
                                        <apex:pageMessages /> 
                                        <apex:pageBlockTable value="{!listBeneficiarios}" var="item"> 
                                            <apex:column headerValue="">
                                                <apex:commandLink title="Eliminar" style="font-size:15px; font-weight:bold; text-align:center;color:red;" value="X" action="{!delRow}" reRender="popBeneficiarios" rendered="{!rowNum>=0}">
                                                    <apex:param value="{!rowNum}" name="index" />
                                                </apex:commandLink>
                                                <apex:variable var="rowNum" value="{!rowNum+1}"/>    
                                            </apex:column>
                                            <apex:column headerValue="Primer Nombre"> 
                                                <!-- apex:outputText value="{!item.Primer_nombre__c} {!item.Segundo_nombre__c} {!item.Primer_apellido__c} {!item.Segundo_apellido__c}"/ -->
                                                <apex:inputField styleClass="slds-input" value="{!item.Primer_Nombre__c}"/>
                                            </apex:column>
                                            <apex:column headerValue="Segundo Nombre"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Segundo_Nombre__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue="Primer Apellido"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Primer_Apellido__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue="Segundo Apellido"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Segundo_Apellido__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue="Parentesco"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Parentesco__c}"/> 
                                            </apex:column>
                                            <!-- apex:column headerValue="Forma de Retiro"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Forma_Retiro__c}"/> 
                                            </apex:column -->
                                            <!-- apex:column headerValue="Sexo"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Sexo__c}"/> 
                                            </apex:column> 
                                            <!-- apex:column headerValue="Nombre del banco"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Nombre_del_banco__c}"/> 
                                            </apex:column> 
                                            <apex:column headerValue="Número de cuenta destino"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Numero_cuenta_destino__c}"/> 
                                            </apex:column --> 
                                            <!-- apex:column headerValue="Tipo de cuenta"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Tipo_cuenta__c}"/> 
                                            </apex:column> 
                                            <apex:column headerValue="Moneda de la cuenta"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Moneda_cuenta__c}"/> 
                                            </apex:column> 
                                            <!-- apex:column headerValue="Monto bruto"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Monto_bruto__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue="Comisiones y cargos"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Comisiones_cargos__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue="Comisiones y cargos"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Monto_neto_retirar__c}"/> 
                                            </apex:column -->
                                            <apex:column headerValue="Identidad"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Identidad__c}" required="true"/> 
                                            </apex:column>
                                            <!-- apex:column headerValue="Porcentaje" style="width:6%"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Porcentaje__c}"/> 
                                            </apex:column -->
                                        </apex:pageBlockTable> 
                                    </apex:pageBlock> 
                                </div>
                            </div>
                        </div>
                        <div class="slds-backdrop slds-backdrop--open"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!popPagoBene}">
                        <div role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open slds-modal_large">
                            <div class="slds-modal__container">
                                <div class="slds-modal__header">
                                    <apex:commandLink action="{!cerrar}" styleclass="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close">
                                        <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Resource.SLDS221, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                        </svg>
                                        <span class="slds-assistive-text">Cerrar</span>
                                    </apex:commandLink>  
                   
                                    <apex:commandButton value="Guardar" action="{!upsertPagosBeneficiarios}" styleClass="slds-button slds-button--brand" />
                                    
                                </div>
                                <div class="slds-modal__content slds-p-around--medium">
                                <div class="scrolling-wrapper">
                                    <apex:pageBlock id="pagosBenefi"> 
                                        <apex:pageMessages /> 
                                        <div style="text-align:right;">(*) Campos Requeridos</div>
                                        <apex:pageBlockTable value="{!listPagosBeneficiarios}" var="item"> 
                                            <!-- apex:column headerValue="Primer Nombre"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Primer_nombre__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue="Segundo Nombre"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Segundo_nombre__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue="Primer Apellido"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Primer_apellido__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue="Segundo Apellido"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Segundo_apellido__c}"/> 
                                            </apex:column -->
                                            <apex:column headerValue="Nombre Completo"> 
                                                <apex:outputText value="{!item.Primer_nombre__c} {!item.Segundo_nombre__c} {!item.Primer_apellido__c} {!item.Segundo_apellido__c}"/>
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <!-- apex:column headerValue="¿Pago a Tercero?"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Pago_a_Tercero__c}"/> 
                                            </apex:column -->
                                            <apex:column headerValue="(*) Forma de Retiro"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Forma_Retiro__c}" id="formaRetiro"> 
                                                    <apex:actionSupport event="onchange" rerender="pagosBenefi"/> 
                                                </apex:inputField>  
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Nombre del banco"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Nombre_banco__c}" style="{!CASE(item.Forma_Retiro__c,"EF",'pointer-events:none; background-color:grey;',"CK",'pointer-events:none; background-color:grey;','')}"/> 
                                            </apex:column> 
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Número de cuenta destino"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Numero_cuenta_destino__c}" style="{!CASE(item.Forma_Retiro__c,"EF",'pointer-events:none; background-color:grey;',"CK",'pointer-events:none; background-color:grey;','')}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column> 
                                            <apex:column headerValue="Tipo de cuenta"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Tipo_cuenta__c}" style="{!CASE(item.Forma_Retiro__c,"EF",'pointer-events:none; background-color:grey;',"CK",'pointer-events:none; background-color:grey;','')}"/> 
                                            </apex:column> 
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="(*) Moneda de la cuenta"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Moneda_cuenta__c}"/> 
                                            </apex:column> 
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="(*) Monto bruto"> 
                                                <!-- abbr class="slds-required" title="required" aura:id="emailReq">*</abbr -->
                                                <apex:inputField styleClass="slds-input" value="{!item.Monto_bruto__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Porcentaje" style="width:6%"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Porcentaje__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Comisiones y cargos"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Comisiones_cargos__c}" style="pointer-events:none; background-color:grey;"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Monto Neto a Retirar"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Monto_neto_retirar__c}" style="pointer-events:none; background-color:grey;"/> 
                                            </apex:column>                                            
                                        </apex:pageBlockTable> 
                                    </apex:pageBlock>                                         
                                </div>
                                </div>
                            </div>
                        </div>
                        <div class="slds-backdrop slds-backdrop--open"></div>
                    </apex:outputPanel>
                    
                    <apex:outputPanel rendered="{!popPagoBene2}">
                        <div role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open slds-modal_large">
                            <div class="slds-modal__container">
                                <div class="slds-modal__header">
                                    <apex:commandLink action="{!cerrar}" styleclass="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close">
                                        <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
                                            <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{!URLFOR($Resource.SLDS221, '/assets/icons/utility-sprite/svg/symbols.svg#close')}"></use>
                                        </svg>
                                        <span class="slds-assistive-text">Cerrar</span>
                                    </apex:commandLink>  
                                    
                                    <div style="{!CASE($Profile.Name,"Operaciones",'display:none;',"Operaciones y Tecnologia",'display:none;','')}">
                                        <div class="slds-grid slds-grid--align-center" style="{!addRecords}" id="botonesBenTer">
                                          <div><apex:commandButton value="Agregar" action="{!addPagoBene2}" styleClass="slds-button slds-button--brand" /></div>
                                          <div><apex:commandButton value="Guardar" action="{!upsertPagosBeneficiarios}" styleClass="slds-button slds-button--brand" /></div>
                                        </div>
                                    </div>
                                
                                </div>
                                <div class="slds-modal__content slds-p-around--medium">
                                <div class="scrolling-wrapper">
                                    <apex:pageBlock id="pagosBenefi2">
                                        <apex:variable var="rowNum2" value="{!0}"  />  
                                        <apex:pageMessages /> 
                                        <div style="text-align:right;">(*) Campos Requeridos</div>
                                        <apex:pageBlockTable value="{!listPagosBeneficiarios2}" var="item">
                                            <apex:column headerValue="" rendered="{!CASE($Profile.Name,"Operaciones",'display:none;',"Operaciones y Tecnologia",'display:none;','')}">
                                                <apex:commandLink title="Eliminar" style="font-size:15px; font-weight:bold; text-align:center;color:red;" value="X" action="{!delRow2}" reRender="pagosBenefi2" rendered="{!rowNum2>=0}">
                                                    <apex:param value="{!rowNum2}" name="index2" />
                                                </apex:commandLink>
                                                <apex:variable var="rowNum2" value="{!rowNum2+1}"/>    
                                            </apex:column> 
                                            <apex:column headerValue="Primer Nombre"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Primer_nombre__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Segundo Nombre"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Segundo_nombre__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Primer Apellido"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Primer_apellido__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Segundo Apellido"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Segundo_apellido__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="(*) Forma de Retiro"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Forma_Retiro__c}" id="formaRetiro"> 
                                                    <apex:actionSupport event="onchange" rerender="pagosBenefi2"/> 
                                                </apex:inputField>  
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Nombre del banco"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Nombre_banco__c}" style="{!CASE(item.Forma_Retiro__c,"EF",'pointer-events:none; background-color:grey;',"CK",'pointer-events:none; background-color:grey;','')}"/> 
                                            </apex:column> 
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Número de cuenta destino"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Numero_cuenta_destino__c}" style="{!CASE(item.Forma_Retiro__c,"EF",'pointer-events:none; background-color:grey;',"CK",'pointer-events:none; background-color:grey;','')}"/> 
                                            </apex:column> 
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Tipo de cuenta"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Tipo_cuenta__c}" style="{!CASE(item.Forma_Retiro__c,"EF",'pointer-events:none; background-color:grey;',"CK",'pointer-events:none; background-color:grey;','')}"/> 
                                            </apex:column> 
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="(*) Moneda de la cuenta"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Moneda_cuenta__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column> 
                                            <apex:column headerValue="(*) Monto bruto"> 
                                                <!-- abbr class="slds-required" title="required" aura:id="emailReq">*</abbr -->
                                                <apex:inputField styleClass="slds-input" value="{!item.Monto_bruto__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Porcentaje" style="width:6%"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Porcentaje__c}"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Comisiones y cargos"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Comisiones_cargos__c}" style="pointer-events:none; background-color:grey;"/> 
                                            </apex:column>
                                            <apex:column headerValue=" "> 
                                                   
                                            </apex:column>
                                            <apex:column headerValue="Monto Neto a Retirar"> 
                                                <apex:inputField styleClass="slds-input" value="{!item.Monto_neto_retirar__c}" style="pointer-events:none; background-color:grey;"/> 
                                            </apex:column>                                            
                                        </apex:pageBlockTable> 
                                    </apex:pageBlock>                                         
                                </div>
                                </div>
                            </div>
                        </div>
                        <div class="slds-backdrop slds-backdrop--open"></div>
                    </apex:outputPanel>
                    <!-- Fin Beneficiarios caso retiro 03/03/2020 -->
                    
                    <apex:outputPanel rendered="{!popSubPro}">
                        <div role="dialog" tabindex="-1" aria-labelledby="header43" class="slds-modal slds-fade-in-open slds-modal_large">
                            <div class="slds-modal__container">
                                <div class="slds-modal__header">
                                    <table>
                                        <tr>
                                            <td>SUBPRODUCTOS</td>
                                            <td><apex:inputtext styleclass="slds-input"  value="{!nombreSubproducto}" onkeypress="enterPress(event)"/></td>
                                            <td><div class="slds-button-group" role="group">
                                                <apex:commandLink value="Buscar" styleclass="slds-button slds-button--brand" action="{!buscarSubPro}"/> 
                                                <apex:commandLink value="X" styleclass="slds-button slds-button--neutral" action="{!cerrar}"/> 
                                                </div></td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="slds-modal__content slds-p-around--medium">
                                    <apex:DataTable value="{!subProductos}" var="item" styleClass="slds-table slds-table--bordered">
                                        <apex:column headerValue="Nombre">
                                            <apex:commandLink action="{!cerrar}" >
                                                <apex:OutputField value="{!item.Name}"/>
                                                <apex:param name="pV2" value="{!item.id}" assignTo="{!detalleCaso.Nuevo_Subproducto__c}"/> 
                                                <apex:param name="pV2SBN" value="{!item.Name}" assignTo="{!detalleCaso.Detalle_subproducto__c}"/>      
                                            </apex:commandLink> 
                                        </apex:column>
                                        <!-- apex:column headerValue="Nombre">
                                            <apex:OutputField value="{!item.Name}"/>                             
                                        </apex:column -->                                                                                 
                                    </apex:DataTable> 
                                </div>
                            </div>
                        </div>
                        <div class="slds-backdrop slds-backdrop--open"></div>
                    </apex:outputPanel>
                    
                </div>
            </apex:form>
        </body>
    </html>
    
</apex:page>